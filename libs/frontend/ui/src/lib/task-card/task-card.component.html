<ng-container *ngIf="state$ | async as state">
  <div class="task-card-content">
    <div class="flex justify-between items-center px-3 pt-2">
      <span class="text-s2 text-black-default font-medium">{{
        state.title
      }}</span>
      <div class="relative">
        <div #triggerEl class="menu-trigger flex invisible">
          <ui-icon
            class="menu-icon cursor-pointer"
            [icon]="'more-horizontal'"
            [size]="'s'"
            [color]="'primary-light2'"
            [hoverColor]="'primary'"
          ></ui-icon>
        </div>
        <ui-popup [triggerEl]="triggerEl" [isCloseWhenPopupAction]="true">
          <div class="menu-items">
            <ui-menu-item
              [itemName]="'編集'"
              [color]="'primary'"
              [icon]="'edit-2'"
              (clickedItem)="clickedEdit.emit()"
            ></ui-menu-item>
            <ui-menu-item
              class="mt-2"
              [itemName]="'サブタスクを追加'"
              [color]="'primary'"
              [icon]="'plus'"
              (clickedItem)="clickedAddSubtask.emit()"
            ></ui-menu-item>
            <ui-menu-item
              class="mt-2"
              [itemName]="'作業予定時間を設定'"
              [color]="'primary'"
              [icon]="'clock'"
              (clickedItem)="clickedEditPlannedTime.emit()"
            ></ui-menu-item>
            <ui-menu-item
              class="mt-2"
              [itemName]="'別のボードに移動'"
              [color]="'primary'"
              [icon]="'arrow-right'"
              (clickedItem)="clickedMoveBoard.emit()"
            ></ui-menu-item>
            <ui-menu-item
              class="mt-2"
              [itemName]="'削除'"
              [color]="'warn'"
              [icon]="'trash-2'"
              (clickedItem)="clickedDelete.emit()"
            ></ui-menu-item>
          </div>
        </ui-popup>
      </div>
    </div>

    <div class="py-1 px-3">
      <ng-content></ng-content>
    </div>
  </div>

  <ng-container
    *ngIf="
      state.selfTrackingTimeSec !== undefined ||
      state.otherTrackingTimeSec !== undefined ||
      state.plannedTimeSec !== undefined
    "
  >
    <hr class="bg-primary-light3" />
    <div class="flex items-center justify-between py-2 px-3">
      <ui-icon
        [icon]="'clock'"
        [size]="'s'"
        [color]="'primary-light2'"
      ></ui-icon>
      <div class="flex items-center">
        <ng-container *ngIf="state.otherTrackingTimeSec !== undefined">
          <ui-time-label
            [status]="'readonly'"
            [sec]="state.otherTrackingTimeSec"
          ></ui-time-label>
        </ng-container>
        <ng-container
          *ngIf="state.selfTrackingTimeSec !== undefined || state.isTracking"
        >
          <ui-tracking-log-change-button
            class="ml-2"
            [trackingTimeSec]="state.selfTrackingTimeSec || 0"
            [plannedTimeSec]="state.plannedTimeSec || 0"
            [isTracking]="state.isTracking"
            (changedTrackingTimeSec)="onChangedTrackingTimeSec$.next($event)"
            (changedPlannedTimeSec)="onChangedPlannedTimeSec$.next($event)"
          ></ui-tracking-log-change-button>
        </ng-container>
      </div>
    </div>
  </ng-container>
</ng-container>
